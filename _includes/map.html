<!-- adapted from https://www.d3-graph-gallery.com/graph/bubblemap_tooltip.html -->
<html>
  <!-- Load d3.js and the geo projection plugin -->
  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.js"></script>
  <script src="https://d3js.org/d3-array.v2.min.js"></script>
<script src="https://d3js.org/d3-geo.v2.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v3.min.js"></script>

  <svg>
    <circle
      style="fill: #69b3a2"
      stroke="black"
      cx="50"
      cy="50"
      r="40"
    ></circle>
  </svg>

  <!-- Create an element where the map will take place -->
  <div id="my_dataviz"></div>

  <style>
    .circle:hover {
      stroke: black;
      stroke-width: 4px;
    }
  </style>

  <script>
    var width = 460;
    var height = 400;
    console.log("trying");

    var svg = d3
      .select("#my_dataviz")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    console.log("trying1");
    var projection = d3
      .geoNaturalEarth2()
      .scale(width / 1.3 / Math.PI)
      .translate([width / 2, height / 2]);

    console.log("trying2");
    var markers = [];
    d3.csv(
      "http://raw.githubusercontent.com/DEST-bio/DEST_freeze1/main/populationInfo/samps.csv",
      function (data) {
        console.log("trying3");
        for (var i = 0; i < data.length - 1; i++) {
          //exclude last element
          var newPoint = {
            long: data[i].long,
            lat: data[i].lat,
            name: data[i].sampleId,
            set: data[i].set,
          };
          markers.push(newPoint); //Add new number to array
          console.log(newPoint);
        }
      }
    );

    // Load external data and boot
    d3.json(
      "http://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson",
      function (data) {
        // Draw the map
        svg
          .append("g")
          .selectAll("path")
          .data(data.features)
          .enter()
          .append("path")
          .attr("fill", "#b8b8b8")
          .attr("d", d3.geoPath().projection(projection))
          .style("stroke", "black")
          .style("opacity", 0.3);

        // create a tooltip
        var Tooltip = d3
          .select("#my_dataviz")
          .append("div")
          .attr("class", "tooltip")
          .style("opacity", 1)
          .style("background-color", "white")
          .style("border", "solid")
          .style("border-width", "2px")
          .style("border-radius", "5px")
          .style("padding", "5px");

        // Three function that change the tooltip when user hover / move / leave a cell
        var mouseover = function (data) {
          Tooltip.style("opacity", 1);
        };
        var mousemove = function (data) {
          Tooltip.html(
            data.name +
              "<br>" +
              "long: " +
              data.long +
              "<br>" +
              "lat: " +
              data.lat
          )
            .style("left", d3.mouse(this)[0] + 10 + "px")
            .style("top", d3.mouse(this)[1] + "px");
        };
        var mouseleave = function (data) {
          Tooltip.style("opacity", 0);
        };

        // Add circles:
        svg
          .selectAll("myCircles")
          .data(markers)
          .enter()
          .append("circle")
          .attr("cx", function (data) {
            return projection([data.long, data.lat])[0];
          })
          .attr("cy", function (data) {
            return projection([data.long, data.lat])[1];
          })
          .attr("r", 7)
          .attr("class", "circle")
          .style("fill", "FFE66D")
          .attr("stroke", function (data) {
            return colorDot(data.set);
          })
          .attr("stroke-width", 3)
          .attr("fill-opacity", 0.4)
          .on("mouseover", mouseover)
          .on("mousemove", mousemove)
          .on("mouseleave", mouseleave);

        //function to set the color of the dot
        function colorDot(set) {
          if (set == "dgn") {
            return "#60B2E5";
          } else if (set == "DrosEU") {
            return "#EC9A29";
          } else if (set == "DrosRTEC") {
            return "#C492B1";
          } else {
            return "#ffffff";
          }
        }
      }
    );
  </script>
</html>
